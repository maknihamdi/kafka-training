.PHONY: help start stop restart clean logs ui status shell

help: ## Afficher l'aide
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Exercice 2 - Topics et Segments                  â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Commandes disponibles:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

start: ## DÃ©marrer le cluster Kafka
	@echo "ğŸš€ DÃ©marrage du cluster Kafka..."
	docker-compose up -d
	@echo "âœ… Cluster Kafka dÃ©marrÃ©!"
	@echo ""
	@echo "ğŸ“Š Kafka UI: http://localhost:8080"
	@echo "ğŸ”§ Pour exÃ©cuter des commandes: make shell"

stop: ## ArrÃªter le cluster Kafka
	@echo "ğŸ›‘ ArrÃªt du cluster Kafka..."
	docker-compose down
	@echo "âœ… Cluster arrÃªtÃ©!"

restart: stop start ## RedÃ©marrer le cluster Kafka

clean: ## Supprimer les volumes et tout nettoyer
	@echo "ğŸ§¹ Nettoyage complet..."
	docker-compose down -v
	@echo "âœ… Nettoyage terminÃ©!"

logs: ## Afficher les logs de Kafka
	docker-compose logs -f kafka

ui: ## Ouvrir Kafka UI dans le navigateur
	@echo "ğŸŒ Ouverture de Kafka UI..."
	@sleep 2
	@open http://localhost:8080 2>/dev/null || xdg-open http://localhost:8080 2>/dev/null || echo "Ouvrez http://localhost:8080 dans votre navigateur"

status: ## Afficher le statut du cluster
	@echo "ğŸ“Š Statut du cluster Kafka:"
	@echo ""
	@docker-compose ps
	@echo ""
	@echo "ğŸ“‹ Topics disponibles:"
	@docker exec kafka kafka-topics --bootstrap-server localhost:9092 --list 2>/dev/null || echo "âš ï¸  Kafka n'est pas encore prÃªt ou aucun topic crÃ©Ã©"

shell: ## Ouvrir un shell dans le container Kafka
	@echo "ğŸ”§ Ouverture d'un shell dans le container Kafka..."
	@echo "ğŸ’¡ Utilisez 'exit' pour quitter"
	@docker exec -it kafka /bin/bash

explore: ## Explorer le systÃ¨me de fichiers Kafka
	@echo "ğŸ“ Exploration du systÃ¨me de fichiers Kafka..."
	@echo ""
	@echo "ğŸ“ RÃ©pertoire des donnÃ©es Kafka:"
	@docker exec kafka ls -lah /var/lib/kafka/data
	@echo ""
	@echo "ğŸ’¡ Pour explorer en dÃ©tail, utilisez: make shell"