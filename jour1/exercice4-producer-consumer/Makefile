.PHONY: help start stop restart clean logs ui status compile run-producer run-consumer

help: ## Afficher l'aide
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Exercice 4 - Producer & Consumer Spring Boot     â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Commandes disponibles:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

start: ## DÃ©marrer le cluster Kafka
	@echo "ğŸš€ DÃ©marrage du cluster Kafka..."
	docker-compose up -d
	@echo "âœ… Cluster Kafka dÃ©marrÃ©!"
	@echo ""
	@echo "â³ Attente de l'initialisation des topics..."
	@sleep 10
	@echo ""
	@echo "ğŸ“Š Kafka UI: http://localhost:8080"
	@echo "ğŸ”§ Bootstrap Server: localhost:9092"
	@echo ""
	@echo "ğŸ“‹ Topics crÃ©Ã©s:"
	@docker exec kafka kafka-topics --bootstrap-server localhost:9092 --list

stop: ## ArrÃªter le cluster Kafka
	@echo "ğŸ›‘ ArrÃªt du cluster Kafka..."
	docker-compose down
	@echo "âœ… Cluster arrÃªtÃ©!"

restart: stop start ## RedÃ©marrer le cluster Kafka

clean: ## Supprimer les volumes et tout nettoyer
	@echo "ğŸ§¹ Nettoyage complet..."
	docker-compose down -v
	@echo "âœ… Nettoyage terminÃ©!"

logs: ## Afficher les logs de Kafka
	docker-compose logs -f kafka

ui: ## Ouvrir Kafka UI dans le navigateur
	@echo "ğŸŒ Ouverture de Kafka UI..."
	@sleep 2
	@open http://localhost:8080 2>/dev/null || xdg-open http://localhost:8080 2>/dev/null || echo "Ouvrez http://localhost:8080 dans votre navigateur"

status: ## Afficher le statut du cluster
	@echo "ğŸ“Š Statut du cluster Kafka:"
	@echo ""
	@docker-compose ps
	@echo ""
	@echo "ğŸ“‹ Topics disponibles:"
	@docker exec kafka kafka-topics --bootstrap-server localhost:9092 --list 2>/dev/null || echo "âš ï¸  Kafka n'est pas encore prÃªt"

compile: ## Compiler les modules Maven
	@echo "ğŸ”¨ Compilation des modules..."
	mvn clean install -DskipTests
	@echo "âœ… Compilation terminÃ©e!"

run-producer: ## Lancer l'application Producer (port 8081)
	@echo "ğŸš€ Lancement du Producer sur le port 8081..."
	@echo "ğŸ“¡ API disponible sur http://localhost:8081"
	@cd producer && mvn spring-boot:run

run-consumer: ## Lancer l'application Consumer
	@echo "ğŸš€ Lancement du Consumer..."
	@cd consumer && mvn spring-boot:run
