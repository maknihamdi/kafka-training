.PHONY: help start stop restart clean logs logs-init ui status

help: ## Afficher l'aide
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Exercice 1 - Explorer le cluster Kafka           â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Commandes disponibles:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

start: ## DÃ©marrer le cluster Kafka (avec provisioning automatique)
	@echo "ğŸš€ DÃ©marrage du cluster Kafka en mode KRaft..."
	docker compose up -d
	@echo "âœ… Cluster Kafka dÃ©marrÃ©!"
	@echo "â³ Le provisioning des donnÃ©es se fait automatiquement..."
	@echo ""
	@echo "ğŸ“Š Kafka UI: http://localhost:8080"
	@echo "ğŸ”§ Schema Registry: http://localhost:8081"
	@echo ""
	@echo "ğŸ’¡ Utilisez 'make logs-init' pour suivre le provisioning"
	@echo "ğŸ’¡ Utilisez 'make ui' pour ouvrir Kafka UI dans le navigateur"

stop: ## ArrÃªter le cluster Kafka
	@echo "ğŸ›‘ ArrÃªt du cluster Kafka..."
	docker compose down
	@echo "âœ… Cluster arrÃªtÃ©!"

restart: stop start ## RedÃ©marrer le cluster Kafka

clean: ## Supprimer les volumes et tout nettoyer
	@echo "ğŸ§¹ Nettoyage complet..."
	docker compose down -v
	@echo "âœ… Nettoyage terminÃ©!"

logs: ## Afficher les logs de Kafka
	docker compose logs -f kafka

logs-init: ## Afficher les logs du provisioning
	docker compose logs -f kafka-init

ui: ## Ouvrir Kafka UI dans le navigateur
	@echo "ğŸŒ Ouverture de Kafka UI..."
	@sleep 2
	@open http://localhost:8080 2>/dev/null || xdg-open http://localhost:8080 2>/dev/null || echo "Ouvrez http://localhost:8080 dans votre navigateur"

status: ## Afficher le statut du cluster
	@echo "ğŸ“Š Statut du cluster Kafka:"
	@echo ""
	@docker compose ps
	@echo ""
	@echo "ğŸ“‹ Topics disponibles:"
	@docker exec kafka kafka-topics --bootstrap-server localhost:9092 --list 2>/dev/null || echo "âš ï¸  Kafka n'est pas encore prÃªt"
